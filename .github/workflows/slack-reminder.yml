name: Rappel Test Site Slack

on:
  schedule:
    # 10h00 heure de Paris = 9h00 UTC (hiver)
    # Actif du 2 au 31 décembre 2025
    - cron: '0 9 2-31 12 *'  # Du 2 au 31 décembre, tous les jours
  workflow_dispatch:
    inputs:
      test_date:
        description: 'Date de test (format: YYYY-MM-DD, ex: 2025-12-05). Laisser vide pour aujourdhui.'
        required: false
        default: ''

jobs:
  send-reminder:
    runs-on: ubuntu-latest
    # Ne s'exécute que si on est en décembre 2025 (ou test manuel)
    if: github.event_name == 'workflow_dispatch' || (github.event_name == 'schedule')
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install requests pytz

      - name: Send Slack reminder
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          TEST_DATE: ${{ github.event.inputs.test_date }}
        run: python reminder.py
