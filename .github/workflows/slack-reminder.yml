name: Rappel Test Site Slack

on:
  schedule:
    # 10h00 heure de Paris = 9h00 UTC (hiver)
    # Actif du 6 au 31 janvier 2026
    - cron: '0 9 6-31 1 *'  # Du 6 au 31 janvier, tous les jours
  workflow_dispatch:
    inputs:
      test_date:
        description: 'Date de test (format: YYYY-MM-DD, ex: 2025-12-05). Laisser vide pour aujourdhui.'
        required: false
        default: ''
      canal_test:
        description: 'Envoyer dans le canal test'
        required: false
        type: boolean
        default: false

jobs:
  send-reminder:
    runs-on: ubuntu-latest
    # Ne s'exécute que si on est en décembre 2025 (ou test manuel)
    if: github.event_name == 'workflow_dispatch' || (github.event_name == 'schedule')
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install requests pytz

      - name: Send Slack reminder
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          SLACK_WEBHOOK_TEST: ${{ secrets.SLACK_WEBHOOK_TEST }}
          TEST_DATE: ${{ github.event.inputs.test_date }}
          CANAL_TEST: ${{ github.event.inputs.canal_test }}
        run: python reminder.py
